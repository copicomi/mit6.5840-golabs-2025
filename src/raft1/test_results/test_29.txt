2025/09/12 19:46:27 [0] S0 restart!!
2025/09/12 19:46:27 [0] S1 restart!!
2025/09/12 19:46:27 [0] S2 restart!!
Test (3D): install snapshots (crash) (unreliable network)...
2025/09/12 19:46:28 [1] S2 start election...
2025/09/12 19:46:28 [1] S2 Got Vote reply from 0, term 1
2025/09/12 19:46:28 [1] S2 Change to leader
2025/09/12 19:46:28 [1] S0 Got append RPC with pervLogIndex 0 loglen 0 term 1
2025/09/12 19:46:28 [1] S0 , apply 0, commit 0, log 0, snapshot 0, len 1
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 0 loglen 0 term 1
2025/09/12 19:46:28 [1] S1 , apply 0, commit 0, log 0, snapshot 0, len 1
2025/09/12 19:46:28 [1] S2 start one(1860653131294524970)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 1
2025/09/12 19:46:28 [1] S0 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S0 , apply 0, commit 0, log 0, snapshot 0, len 1
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S1 , apply 0, commit 0, log 0, snapshot 0, len 1
2025/09/12 19:46:28 [1] S2 send APPEND ENTRIES RPC to server 1, prev 0, loglen 1, term 1
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 0 loglen 1 term 1
2025/09/12 19:46:28 [1] S1 , apply 0, commit 0, log 0, snapshot 0, len 1
2025/09/12 19:46:28 [1] S1 Append 1 logs, lastLogIndex = 1
2025/09/12 19:46:28 [1] S2 Update commit index to 1
2025/09/12 19:46:28 [1] S2 Apply 1 logs to 1
2025/09/12 19:46:28 [1] S2 begin apply log 1
2025/09/12 19:46:28 [1] S2 APPLY , apply 0, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S2 end apply log 1
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S1 , apply 0, commit 0, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S0 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S0 , apply 0, commit 0, log 0, snapshot 0, len 1
2025/09/12 19:46:28 [1] S2 send APPEND ENTRIES RPC to server 0, prev 0, loglen 1, term 1
2025/09/12 19:46:28 [1] S0 Got append RPC with pervLogIndex 0 loglen 1 term 1
2025/09/12 19:46:28 [1] S0 , apply 0, commit 0, log 0, snapshot 0, len 1
2025/09/12 19:46:28 [1] S0 Append 1 logs, lastLogIndex = 1
2025/09/12 19:46:28 [1] S0 Apply 1 logs to 1
2025/09/12 19:46:28 [1] S0 begin apply log 1
2025/09/12 19:46:28 [1] S0 APPLY , apply 0, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S0 end apply log 1
2025/09/12 19:46:28 [1] S1 Apply 1 logs to 1
2025/09/12 19:46:28 [1] S1 begin apply log 1
2025/09/12 19:46:28 [1] S1 APPLY , apply 0, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S1 end apply log 1
2025/09/12 19:46:28 [1] S0 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S0 , apply 1, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S1 , apply 1, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S1 , apply 1, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S0 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S0 , apply 1, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S1 , apply 1, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S0 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S0 , apply 1, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S1 , apply 1, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S0 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S0 , apply 1, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S0 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S0 , apply 1, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 1 loglen 0 term 1
2025/09/12 19:46:28 [1] S1 , apply 1, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S2 start one(2192537854768364633)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 2
2025/09/12 19:46:28 [1] S2 send APPEND ENTRIES RPC to server 1, prev 1, loglen 1, term 1
2025/09/12 19:46:28 [1] S2 send APPEND ENTRIES RPC to server 0, prev 1, loglen 1, term 1
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 1 loglen 1 term 1
2025/09/12 19:46:28 [1] S1 , apply 1, commit 1, log 1, snapshot 0, len 2
2025/09/12 19:46:28 [1] S1 Append 1 logs, lastLogIndex = 2
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 2 loglen 0 term 1
2025/09/12 19:46:28 [1] S1 , apply 1, commit 1, log 2, snapshot 0, len 3
2025/09/12 19:46:28 [1] S2 Update commit index to 2
2025/09/12 19:46:28 [1] S2 Apply 1 logs to 2
2025/09/12 19:46:28 [1] S2 begin apply log 2
2025/09/12 19:46:28 [1] S2 APPLY , apply 1, commit 2, log 2, snapshot 0, len 3
2025/09/12 19:46:28 [1] S2 end apply log 2
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 2 loglen 0 term 1
2025/09/12 19:46:28 [1] S1 , apply 1, commit 1, log 2, snapshot 0, len 3
2025/09/12 19:46:28 [1] S1 Apply 1 logs to 2
2025/09/12 19:46:28 [1] S1 begin apply log 2
2025/09/12 19:46:28 [1] S1 APPLY , apply 1, commit 2, log 2, snapshot 0, len 3
2025/09/12 19:46:28 [1] S1 end apply log 2
2025/09/12 19:46:28 [1] S2 start one(3963377395780862478)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 3
2025/09/12 19:46:28 [1] S2 send APPEND ENTRIES RPC to server 1, prev 2, loglen 1, term 1
2025/09/12 19:46:28 [1] S2 start one(8124849690152963357)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 4
2025/09/12 19:46:28 [1] S2 start one(2704239237481902545)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 5
2025/09/12 19:46:28 [1] S2 start one(1618466806034060561)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 6
2025/09/12 19:46:28 [1] S2 send APPEND ENTRIES RPC to server 0, prev 1, loglen 5, term 1
2025/09/12 19:46:28 [1] S2 start one(8685009416052086019)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 7
2025/09/12 19:46:28 [1] S2 start one(6908360655139192012)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 8
2025/09/12 19:46:28 [1] S2 start one(6352540031166420579)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 9
2025/09/12 19:46:28 [1] S2 start one(4805928899173616157)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 10
2025/09/12 19:46:28 [1] S2 start one(752378293570008026)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 11
2025/09/12 19:46:28 [1] S2 start one(2568862512025416269)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 12
2025/09/12 19:46:28 [1] S2 start one(5394238807165693896)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 13
2025/09/12 19:46:28 [1] S2 start one(2966127305808145312)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 14
2025/09/12 19:46:28 [1] S2 start one(2340097455002848546)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 15
2025/09/12 19:46:28 [1] S2 start one(7670569473539255579)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 16
2025/09/12 19:46:28 [1] S2 start one(2277167840365474273)
2025/09/12 19:46:28 [1] S2 Append 1 logs, lastLogIndex = 17
2025/09/12 19:46:28 [1] S1 Got append RPC with pervLogIndex 2 loglen 1 term 1
2025/09/12 19:46:28 [1] S1 , apply 2, commit 2, log 2, snapshot 0, len 3
2025/09/12 19:46:28 [1] S1 Append 1 logs, lastLogIndex = 3
2025/09/12 19:46:29 [1] S2 Update commit index to 3
2025/09/12 19:46:29 [1] S2 Apply 1 logs to 3
2025/09/12 19:46:29 [1] S2 begin apply log 3
2025/09/12 19:46:29 [1] S2 APPLY , apply 2, commit 3, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S2 end apply log 3
2025/09/12 19:46:29 [1] S1 Got append RPC with pervLogIndex 17 loglen 0 term 1
2025/09/12 19:46:29 [1] S1 , apply 2, commit 2, log 3, snapshot 0, len 4
2025/09/12 19:46:29 [1] S1 Got append RPC with pervLogIndex 17 loglen 0 term 1
2025/09/12 19:46:29 [1] S1 , apply 2, commit 2, log 3, snapshot 0, len 4
2025/09/12 19:46:29 [1] S2 send APPEND ENTRIES RPC to server 1, prev 3, loglen 14, term 1
2025/09/12 19:46:29 [1] S1 Got append RPC with pervLogIndex 17 loglen 0 term 1
2025/09/12 19:46:29 [1] S1 , apply 2, commit 2, log 3, snapshot 0, len 4
2025/09/12 19:46:29 [1] S2 send APPEND ENTRIES RPC to server 1, prev 3, loglen 14, term 1
2025/09/12 19:46:29 [1] S1 Got append RPC with pervLogIndex 3 loglen 14 term 1
2025/09/12 19:46:29 [1] S1 , apply 2, commit 2, log 3, snapshot 0, len 4
2025/09/12 19:46:29 [1] S1 Append 14 logs, lastLogIndex = 17
2025/09/12 19:46:29 [1] S1 Apply 1 logs to 3
2025/09/12 19:46:29 [1] S1 begin apply log 3
2025/09/12 19:46:29 [1] S1 APPLY , apply 2, commit 3, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S1 end apply log 3
2025/09/12 19:46:29 [1] S2 Update commit index to 17
2025/09/12 19:46:29 [1] S1 Got append RPC with pervLogIndex 17 loglen 0 term 1
2025/09/12 19:46:29 [1] S1 , apply 3, commit 3, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S2 Apply 14 logs to 17
2025/09/12 19:46:29 [1] S2 begin apply log 4
2025/09/12 19:46:29 [1] S2 APPLY , apply 3, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S2 end apply log 4
2025/09/12 19:46:29 [1] S2 begin apply log 5
2025/09/12 19:46:29 [1] S2 APPLY , apply 4, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S2 end apply log 5
2025/09/12 19:46:29 [1] S2 begin apply log 6
2025/09/12 19:46:29 [1] S2 APPLY , apply 5, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S2 end apply log 6
2025/09/12 19:46:29 [1] S2 begin apply log 7
2025/09/12 19:46:29 [1] S2 APPLY , apply 6, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S2 end apply log 7
2025/09/12 19:46:29 [1] S2 begin apply log 8
2025/09/12 19:46:29 [1] S2 APPLY , apply 7, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S2 end apply log 8
2025/09/12 19:46:29 [1] S2 begin apply log 9
2025/09/12 19:46:29 [1] S2 APPLY , apply 8, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S2 end apply log 9
2025/09/12 19:46:29 [1] S2 begin apply log 10
2025/09/12 19:46:29 [1] S2 APPLY , apply 9, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S2 SNAPSHOT at 9
2025/09/12 19:46:29 [1] S1 Apply 14 logs to 17
==================
WARNING: DATA RACE
Read at 0x00c0000fe3c8 by goroutine 26:
  6.5840/raft1.mDebugIndex()
      /home/akane/learning/6.5840/src/raft1/util.go:35 +0x104
  6.5840/raft1.(*Raft).SnapShotWithoutLock()
      /home/akane/learning/6.5840/src/raft1/snapshot.go:94 +0xd1
  6.5840/raft1.(*Raft).Snapshot()
      /home/akane/learning/6.5840/src/raft1/raft.go:60 +0x4e
  6.5840/raft1.(*rfsrv).applierSnap()
      /home/akane/learning/6.5840/src/raft1/server.go:154 +0x8de
  6.5840/raft1.newRfsrv.gowrap1()
      /home/akane/learning/6.5840/src/raft1/server.go:57 +0x44

Previous write at 0x00c0000fe3c8 by goroutine 23:
  6.5840/raft1.(*Raft).ApplyCommittedLogs()
      /home/akane/learning/6.5840/src/raft1/commit.go:26 +0x1af
  6.5840/raft1.(*Raft).applier()
      /home/akane/learning/6.5840/src/raft1/commit.go:13 +0x99
2025/09/12 19:46:29 [1] S1 begin apply log 4
  6.5840/raft1.Make.gowrap2()
      /home/akane/learning/6.5840/src/raft1/raft.go:90 +0x33

Goroutine 26 (running) created at:
  6.5840/raft1.newRfsrv()
      /home/akane/learning/6.5840/src/raft1/server.go:57 +0x404
  6.5840/raft1.(*Test).mksrv()
      /home/akane/learning/6.5840/src/raft1/test.go:52 +0x92
  6.5840/raft1.(*Test).mksrv-fm()
      <autogenerated>:1 +0x89
  6.5840/tester1.(*ServerGrp).StartServer()
      /home/akane/learning/6.5840/src/tester1/group.go:239 +0x247
  6.5840/tester1.(*ServerGrp).start()
      /home/akane/learning/6.5840/src/tester1/group.go:278 +0x5c
  6.5840/tester1.(*ServerGrp).StartServers()
      /home/akane/learning/6.5840/src/tester1/group.go:250 +0x35
  6.5840/tester1.(*Config).MakeGroupStart()
      /home/akane/learning/6.5840/src/tester1/config.go:92 +0x89
  6.5840/tester1.MakeConfig()
      /home/akane/learning/6.5840/src/tester1/config.go:49 +0x29e
  6.5840/raft1.makeTest()
      /home/akane/learning/6.5840/src/raft1/test.go:38 +0x1ee
  6.5840/raft1.snapcommon()
      /home/akane/learning/6.5840/src/raft1/raft_test.go:1229 +0x78
  6.5840/raft1.TestSnapshotInstallUnCrash3D()
      /home/akane/learning/6.5840/src/raft1/raft_test.go:1315 +0x3c
  testing.tRunner()
      /usr/lib/go-1.22/src/testing/testing.go:1689 +0x21e
  testing.(*T).Run.gowrap1()
      /usr/lib/go-1.22/src/testing/testing.go:1742 +0x44

Goroutine 23 (running) created at:
  6.5840/raft1.Make()
      /home/akane/learning/6.5840/src/raft1/raft.go:90 +0x44d
  6.5840/raft1.newRfsrv()
      /home/akane/learning/6.5840/src/raft1/server.go:44 +0x20c
  6.5840/raft1.(*Test).mksrv()
      /home/akane/learning/6.5840/src/raft1/test.go:52 +0x92
  6.5840/raft1.(*Test).mksrv-fm()
      <autogenerated>:1 +0x89
  6.5840/tester1.(*ServerGrp).StartServer()
      /home/akane/learning/6.5840/src/tester1/group.go:239 +0x247
  6.5840/tester1.(*ServerGrp).start()
      /home/akane/learning/6.5840/src/tester1/group.go:278 +0x5c
  6.5840/tester1.(*ServerGrp).StartServers()
      /home/akane/learning/6.5840/src/tester1/group.go:250 +0x35
  6.5840/tester1.(*Config).MakeGroupStart()
      /home/akane/learning/6.5840/src/tester1/config.go:92 +0x89
2025/09/12 19:46:29 [1] S1 APPLY , apply 3, commit 17, log 17, snapshot 0, len 18
  6.5840/tester1.MakeConfig()
      /home/akane/learning/6.5840/src/tester1/config.go:49 +0x29e
  6.5840/raft1.makeTest()
      /home/akane/learning/6.5840/src/raft1/test.go:38 +0x1ee
  6.5840/raft1.snapcommon()
      /home/akane/learning/6.5840/src/raft1/raft_test.go:1229 +0x78
  6.5840/raft1.TestSnapshotInstallUnCrash3D()
      /home/akane/learning/6.5840/src/raft1/raft_test.go:1315 +0x3c
  testing.tRunner()
      /usr/lib/go-1.22/src/testing/testing.go:1689 +0x21e
  testing.(*T).Run.gowrap1()
      /usr/lib/go-1.22/src/testing/testing.go:1742 +0x44
==================
2025/09/12 19:46:29 [1] S2 snapshot, apply 10, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S1 end apply log 4
2025/09/12 19:46:29 [1] S1 begin apply log 5
==================
WARNING: DATA RACE
Write at 0x00c0000fe3a8 by goroutine 26:
  6.5840/raft1.(*Raft).SnapShotWithoutLock()
      /home/akane/learning/6.5840/src/raft1/snapshot.go:100 +0x248
  6.5840/raft1.(*Raft).Snapshot()
      /home/akane/learning/6.5840/src/raft1/raft.go:60 +0x4e
  6.5840/raft1.(*rfsrv).applierSnap()
      /home/akane/learning/6.5840/src/raft1/server.go:154 +0x8de
  6.5840/raft1.newRfsrv.gowrap1()
      /home/akane/learning/6.5840/src/raft1/server.go:57 +0x44

Previous read at 0x00c0000fe3a8 by goroutine 23:
  6.5840/raft1.(*Raft).GetLogAtIndexWithoutLock()
      /home/akane/learning/6.5840/src/raft1/states.go:125 +0x3b2
  6.5840/raft1.(*Raft).ApplyCommittedLogs()
      /home/akane/learning/6.5840/src/raft1/commit.go:25 +0x389
  6.5840/raft1.(*Raft).applier()
      /home/akane/learning/6.5840/src/raft1/commit.go:13 +0x99
  6.5840/raft1.Make.gowrap2()
      /home/akane/learning/6.5840/src/raft1/raft.go:90 +0x33

Goroutine 26 (running) created at:
  6.5840/raft1.newRfsrv()
      /home/akane/learning/6.5840/src/raft1/server.go:57 +0x404
  6.5840/raft1.(*Test).mksrv()
      /home/akane/learning/6.5840/src/raft1/test.go:52 +0x92
  6.5840/raft1.(*Test).mksrv-fm()
      <autogenerated>:1 +0x89
  6.5840/tester1.(*ServerGrp).StartServer()
      /home/akane/learning/6.5840/src/tester1/group.go:239 +0x247
  6.5840/tester1.(*ServerGrp).start()
      /home/akane/learning/6.5840/src/tester1/group.go:278 +0x5c
  6.5840/tester1.(*ServerGrp).StartServers()
      /home/akane/learning/6.5840/src/tester1/group.go:250 +0x35
2025/09/12 19:46:29 [1] S1 APPLY , apply 4, commit 17, log 17, snapshot 0, len 18
  6.5840/tester1.(*Config).MakeGroupStart()
      /home/akane/learning/6.5840/src/tester1/config.go:92 +0x89
  6.5840/tester1.MakeConfig()
      /home/akane/learning/6.5840/src/tester1/config.go:49 +0x29e
  6.5840/raft1.makeTest()
      /home/akane/learning/6.5840/src/raft1/test.go:38 +0x1ee
  6.5840/raft1.snapcommon()
      /home/akane/learning/6.5840/src/raft1/raft_test.go:1229 +0x78
  6.5840/raft1.TestSnapshotInstallUnCrash3D()
      /home/akane/learning/6.5840/src/raft1/raft_test.go:1315 +0x3c
  testing.tRunner()
      /usr/lib/go-1.22/src/testing/testing.go:1689 +0x21e
  testing.(*T).Run.gowrap1()
      /usr/lib/go-1.22/src/testing/testing.go:1742 +0x44

Goroutine 23 (running) created at:
  6.5840/raft1.Make()
      /home/akane/learning/6.5840/src/raft1/raft.go:90 +0x44d
  6.5840/raft1.newRfsrv()
      /home/akane/learning/6.5840/src/raft1/server.go:44 +0x20c
  6.5840/raft1.(*Test).mksrv()
      /home/akane/learning/6.5840/src/raft1/test.go:52 +0x92
  6.5840/raft1.(*Test).mksrv-fm()
      <autogenerated>:1 +0x89
  6.5840/tester1.(*ServerGrp).StartServer()
      /home/akane/learning/6.5840/src/tester1/group.go:239 +0x247
  6.5840/tester1.(*ServerGrp).start()
      /home/akane/learning/6.5840/src/tester1/group.go:278 +0x5c
  6.5840/tester1.(*ServerGrp).StartServers()
      /home/akane/learning/6.5840/src/tester1/group.go:250 +0x35
  6.5840/tester1.(*Config).MakeGroupStart()
      /home/akane/learning/6.5840/src/tester1/config.go:92 +0x89
  6.5840/tester1.MakeConfig()
      /home/akane/learning/6.5840/src/tester1/config.go:49 +0x29e
  6.5840/raft1.makeTest()
      /home/akane/learning/6.5840/src/raft1/test.go:38 +0x1ee
  6.5840/raft1.snapcommon()
      /home/akane/learning/6.5840/src/raft1/raft_test.go:1229 +0x78
  6.5840/raft1.TestSnapshotInstallUnCrash3D()
      /home/akane/learning/6.5840/src/raft1/raft_test.go:1315 +0x3c
  testing.tRunner()
      /usr/lib/go-1.22/src/testing/testing.go:1689 +0x21e
  testing.(*T).Run.gowrap1()
      /usr/lib/go-1.22/src/testing/testing.go:1742 +0x44
==================
2025/09/12 19:46:29 [1] S1 end apply log 5
2025/09/12 19:46:29 [1] S1 begin apply log 6
2025/09/12 19:46:29 [1] S1 APPLY , apply 5, commit 17, log 17, snapshot 0, len 18
==================
WARNING: DATA RACE
Write at 0x00c0000fe448 by goroutine 26:
2025/09/12 19:46:29 [1] S1 end apply log 6
  6.5840/raft1.(*Raft).SnapShotWithoutLock()
      /home/akane/learning/6.5840/src/raft1/snapshot.go:101 +0x2b4
  6.5840/raft1.(*Raft).Snapshot()
      /home/akane/learning/6.5840/src/raft1/raft.go:60 +0x4e
  6.5840/raft1.(*rfsrv).applierSnap()
      /home/akane/learning/6.5840/src/raft1/server.go:154 +0x8de
  6.5840/raft1.newRfsrv.gowrap1()
      /home/akane/learning/6.5840/src/raft1/server.go:57 +0x44

Previous read at 0x00c0000fe448 by goroutine 23:
  6.5840/raft1.(*Raft).GetLogAtIndexWithoutLock()
      /home/akane/learning/6.5840/src/raft1/states.go:124 +0x391
  6.5840/raft1.(*Raft).ApplyCommittedLogs()
      /home/akane/learning/6.5840/src/raft1/commit.go:25 +0x389
  6.5840/raft1.(*Raft).applier()
      /home/akane/learning/6.5840/src/raft1/commit.go:13 +0x99
  6.5840/raft1.Make.gowrap2()
      /home/akane/learning/6.5840/src/raft1/raft.go:90 +0x33

Goroutine 26 (running) created at:
  6.5840/raft1.newRfsrv()
      /home/akane/learning/6.5840/src/raft1/server.go:57 +0x404
  6.5840/raft1.(*Test).mksrv()
      /home/akane/learning/6.5840/src/raft1/test.go:52 +0x92
  6.5840/raft1.(*Test).mksrv-fm()
      <autogenerated>:1 +0x89
  6.5840/tester1.(*ServerGrp).StartServer()
      /home/akane/learning/6.5840/src/tester1/group.go:239 +0x247
  6.5840/tester1.(*ServerGrp).start()
      /home/akane/learning/6.5840/src/tester1/group.go:278 +0x5c
  6.5840/tester1.(*ServerGrp).StartServers()
      /home/akane/learning/6.5840/src/tester1/group.go:250 +0x35
  6.5840/tester1.(*Config).MakeGroupStart()
      /home/akane/learning/6.5840/src/tester1/config.go:92 +0x89
  6.5840/tester1.MakeConfig()
      /home/akane/learning/6.5840/src/tester1/config.go:49 +0x29e
  6.5840/raft1.makeTest()
      /home/akane/learning/6.5840/src/raft1/test.go:38 +0x1ee
  6.5840/raft1.snapcommon()
      /home/akane/learning/6.5840/src/raft1/raft_test.go:1229 +0x78
  6.5840/raft1.TestSnapshotInstallUnCrash3D()
      /home/akane/learning/6.5840/src/raft1/raft_test.go:1315 +0x3c
  testing.tRunner()
      /usr/lib/go-1.22/src/testing/testing.go:1689 +0x21e
  testing.(*T).Run.gowrap1()
      /usr/lib/go-1.22/src/testing/testing.go:1742 +0x44

Goroutine 23 (running) created at:
  6.5840/raft1.Make()
      /home/akane/learning/6.5840/src/raft1/raft.go:90 +0x44d
  6.5840/raft1.newRfsrv()
      /home/akane/learning/6.5840/src/raft1/server.go:44 +0x20c
  6.5840/raft1.(*Test).mksrv()
      /home/akane/learning/6.5840/src/raft1/test.go:52 +0x92
  6.5840/raft1.(*Test).mksrv-fm()
      <autogenerated>:1 +0x89
  6.5840/tester1.(*ServerGrp).StartServer()
      /home/akane/learning/6.5840/src/tester1/group.go:239 +0x247
  6.5840/tester1.(*ServerGrp).start()
      /home/akane/learning/6.5840/src/tester1/group.go:278 +0x5c
  6.5840/tester1.(*ServerGrp).StartServers()
      /home/akane/learning/6.5840/src/tester1/group.go:250 +0x35
  6.5840/tester1.(*Config).MakeGroupStart()
      /home/akane/learning/6.5840/src/tester1/config.go:92 +0x89
  6.5840/tester1.MakeConfig()
      /home/akane/learning/6.5840/src/tester1/config.go:49 +0x29e
  6.5840/raft1.makeTest()
      /home/akane/learning/6.5840/src/raft1/test.go:38 +0x1ee
  6.5840/raft1.snapcommon()
      /home/akane/learning/6.5840/src/raft1/raft_test.go:1229 +0x78
  6.5840/raft1.TestSnapshotInstallUnCrash3D()
      /home/akane/learning/6.5840/src/raft1/raft_test.go:1315 +0x3c
  testing.tRunner()
      /usr/lib/go-1.22/src/testing/testing.go:1689 +0x21e
  testing.(*T).Run.gowrap1()
      /usr/lib/go-1.22/src/testing/testing.go:1742 +0x44
==================
2025/09/12 19:46:29 [1] S1 begin apply log 7
2025/09/12 19:46:29 [1] S1 APPLY , apply 6, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S1 end apply log 7
2025/09/12 19:46:29 [1] S1 begin apply log 8
2025/09/12 19:46:29 [1] S1 APPLY , apply 7, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S1 end apply log 8
2025/09/12 19:46:29 [1] S1 begin apply log 9
2025/09/12 19:46:29 [1] S1 APPLY , apply 8, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S2 snapshot END, apply 10, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S2 end apply log 10
2025/09/12 19:46:29 [1] S2 begin apply log 11
2025/09/12 19:46:29 [1] S2 APPLY , apply 10, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S2 end apply log 11
2025/09/12 19:46:29 [1] S2 begin apply log 12
2025/09/12 19:46:29 [1] S2 APPLY , apply 11, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S2 end apply log 12
2025/09/12 19:46:29 [1] S2 begin apply log 13
2025/09/12 19:46:29 [1] S2 APPLY , apply 12, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S2 end apply log 13
2025/09/12 19:46:29 [1] S2 begin apply log 14
2025/09/12 19:46:29 [1] S2 APPLY , apply 13, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S1 end apply log 9
2025/09/12 19:46:29 [1] S1 begin apply log 10
2025/09/12 19:46:29 [1] S1 APPLY , apply 9, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S2 end apply log 14
2025/09/12 19:46:29 [1] S2 begin apply log 15
2025/09/12 19:46:29 [1] S2 APPLY , apply 14, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S2 end apply log 15
2025/09/12 19:46:29 [1] S2 begin apply log 16
2025/09/12 19:46:29 [1] S2 APPLY , apply 15, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S2 end apply log 16
2025/09/12 19:46:29 [1] S2 begin apply log 17
2025/09/12 19:46:29 [1] S2 APPLY , apply 16, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S2 end apply log 17
2025/09/12 19:46:29 [1] S1 SNAPSHOT at 9
2025/09/12 19:46:29 [1] S1 snapshot, apply 10, commit 17, log 17, snapshot 0, len 18
2025/09/12 19:46:29 [1] S1 snapshot END, apply 10, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S1 end apply log 10
2025/09/12 19:46:29 [1] S1 begin apply log 11
2025/09/12 19:46:29 [1] S1 APPLY , apply 10, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S1 end apply log 11
2025/09/12 19:46:29 [1] S1 begin apply log 12
2025/09/12 19:46:29 [1] S1 APPLY , apply 11, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S1 end apply log 12
2025/09/12 19:46:29 [1] S1 begin apply log 13
2025/09/12 19:46:29 [1] S1 APPLY , apply 12, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S1 end apply log 13
2025/09/12 19:46:29 [1] S1 begin apply log 14
2025/09/12 19:46:29 [1] S1 APPLY , apply 13, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S1 end apply log 14
2025/09/12 19:46:29 [1] S1 begin apply log 15
2025/09/12 19:46:29 [1] S1 APPLY , apply 14, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S1 end apply log 15
2025/09/12 19:46:29 [1] S1 begin apply log 16
2025/09/12 19:46:29 [1] S1 APPLY , apply 15, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S1 end apply log 16
2025/09/12 19:46:29 [1] S1 begin apply log 17
2025/09/12 19:46:29 [1] S1 APPLY , apply 16, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S1 end apply log 17
2025/09/12 19:46:29 [1] S0 restart!!
2025/09/12 19:46:29 [1] S2 start one(3480459345268348241)
2025/09/12 19:46:29 [1] S2 Append 1 logs, lastLogIndex = 18
2025/09/12 19:46:29 [1] S2 send InstallSnapshot to 0 at 9
2025/09/12 19:46:29 [1] S0 InstallSnapshot start, apply 0, commit 0, log 1, snapshot 0, len 2
2025/09/12 19:46:29 [1] S0 InstallSnapshot end, apply 9, commit 9, log 9, snapshot 9, len 1
2025/09/12 19:46:29 [1] S2 HandleInstallReply from server 0 term 1
2025/09/12 19:46:29 [1] S2 InstallSnapshot update matchIndex 0 to 9
2025/09/12 19:46:29 [1] S0 Got append RPC with pervLogIndex 18 loglen 0 term 1
2025/09/12 19:46:29 [1] S0 , apply 9, commit 9, log 9, snapshot 9, len 1
2025/09/12 19:46:29 [1] S1 Got append RPC with pervLogIndex 18 loglen 0 term 1
2025/09/12 19:46:29 [1] S1 , apply 17, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S2 send APPEND ENTRIES RPC to server 1, prev 17, loglen 1, term 1
2025/09/12 19:46:29 [1] S1 Got append RPC with pervLogIndex 17 loglen 1 term 1
2025/09/12 19:46:29 [1] S1 , apply 17, commit 17, log 17, snapshot 9, len 9
2025/09/12 19:46:29 [1] S1 Append 1 logs, lastLogIndex = 18
2025/09/12 19:46:29 [1] S2 Update commit index to 18
2025/09/12 19:46:29 [1] S0 Got append RPC with pervLogIndex 18 loglen 0 term 1
2025/09/12 19:46:29 [1] S0 , apply 9, commit 9, log 9, snapshot 9, len 1
2025/09/12 19:46:29 [1] S2 send APPEND ENTRIES RPC to server 0, prev 9, loglen 9, term 1
2025/09/12 19:46:29 [1] S0 Got append RPC with pervLogIndex 9 loglen 9 term 1
2025/09/12 19:46:29 [1] S0 , apply 9, commit 9, log 9, snapshot 9, len 1
2025/09/12 19:46:29 [1] S0 Append 9 logs, lastLogIndex = 18
2025/09/12 19:46:29 [1] S0 Apply 9 logs to 18
2025/09/12 19:46:29 [1] S2 Apply 1 logs to 18
2025/09/12 19:46:29 [1] S0 begin apply log 10
2025/09/12 19:46:29 [1] S2 begin apply log 18
2025/09/12 19:46:29 [1] S2 APPLY , apply 17, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S0 APPLY , apply 9, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S2 end apply log 18
2025/09/12 19:46:29 [1] S0 end apply log 10
2025/09/12 19:46:29 [1] S0 begin apply log 11
2025/09/12 19:46:29 [1] S0 APPLY , apply 10, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S0 end apply log 11
2025/09/12 19:46:29 [1] S0 begin apply log 12
2025/09/12 19:46:29 [1] S0 APPLY , apply 11, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S0 end apply log 12
2025/09/12 19:46:29 [1] S0 begin apply log 13
2025/09/12 19:46:29 [1] S0 APPLY , apply 12, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S0 end apply log 13
2025/09/12 19:46:29 [1] S0 begin apply log 14
2025/09/12 19:46:29 [1] S0 APPLY , apply 13, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S0 end apply log 14
2025/09/12 19:46:29 [1] S0 begin apply log 15
2025/09/12 19:46:29 [1] S0 APPLY , apply 14, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S0 end apply log 15
2025/09/12 19:46:29 [1] S0 begin apply log 16
2025/09/12 19:46:29 [1] S0 APPLY , apply 15, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S0 end apply log 16
2025/09/12 19:46:29 [1] S0 begin apply log 17
2025/09/12 19:46:29 [1] S0 APPLY , apply 16, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S0 end apply log 17
2025/09/12 19:46:29 [1] S0 begin apply log 18
2025/09/12 19:46:29 [1] S0 APPLY , apply 17, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S0 end apply log 18
2025/09/12 19:46:29 [1] S1 Got append RPC with pervLogIndex 18 loglen 0 term 1
2025/09/12 19:46:29 [1] S1 , apply 17, commit 17, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S1 Apply 1 logs to 18
2025/09/12 19:46:29 [1] S1 begin apply log 18
2025/09/12 19:46:29 [1] S1 APPLY , apply 17, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S1 end apply log 18
2025/09/12 19:46:29 [1] S1 Got append RPC with pervLogIndex 18 loglen 0 term 1
2025/09/12 19:46:29 [1] S1 , apply 18, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S0 Got append RPC with pervLogIndex 18 loglen 0 term 1
2025/09/12 19:46:29 [1] S0 , apply 18, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S1 Got append RPC with pervLogIndex 18 loglen 0 term 1
2025/09/12 19:46:29 [1] S1 , apply 18, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:29 [1] S0 Got append RPC with pervLogIndex 18 loglen 0 term 1
2025/09/12 19:46:29 [1] S0 , apply 18, commit 18, log 18, snapshot 9, len 10
2025/09/12 19:46:27 [1] S1 Got append RPC with pervLogIndex 18 loglen 0 term 1
2025/09/12 19:46:27 [1] S1 , apply 18, commit 18, log 18, snapshot 9, len 10
info: wrote visualization to /tmp/porcupine-1290102851.html
exit status 1
FAIL	6.5840/raft1	2.455s
